(window.webpackJsonp=window.webpackJsonp||[]).push([[57],{428:function(t,s,a){"use strict";a.r(s);var e=a(46),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"第09章-子查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第09章-子查询"}},[t._v("#")]),t._v(" 第09章_子查询")]),t._v(" "),a("p",[t._v("子查询指一个查询语句嵌套在另一个查询语句内部的查询，这个特性从MySQL 4.1开始引入。")]),t._v(" "),a("p",[t._v("SQL 中子查询的使用大大增强了 SELECT 查询的能力，因为很多时候查询需要从结果集中获取数据，或者需要从同一个表中先计算得出一个数据结果，然后与这个数据结果（可能是某个标量，也可能是某个集合）进行比较。")]),t._v(" "),a("h2",{attrs:{id:"_1-需求分析与问题解决"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-需求分析与问题解决"}},[t._v("#")]),t._v(" 1. 需求分析与问题解决")]),t._v(" "),a("h3",{attrs:{id:"_1-1-实际问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-实际问题"}},[t._v("#")]),t._v(" 1.1 实际问题")]),t._v(" "),a("img",{staticStyle:{zoom:"80%"},attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/mysql/1554991034688.png",alt:"1554991034688"}}),t._v(" "),a("p",[t._v("现有解决方式：")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#方式一：")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" salary\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" employees\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v(" last_name "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Abel'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" last_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("salary\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" employees\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v(" salary "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("11000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#方式二：自连接")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" e2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("last_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("e2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("salary\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" employees e1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("employees e2\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v(" e1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("last_name "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Abel'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("AND")]),t._v(" e1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("salary"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" e2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("salary"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("\n")])])]),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#方式三：子查询")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" last_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("salary\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" employees\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v(" salary "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" salary\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" employees\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v(" last_name "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Abel'")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/mysql/1554991316599.png",alt:"1554991316599"}})]),t._v(" "),a("h3",{attrs:{id:"_1-2-子查询的基本使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-子查询的基本使用"}},[t._v("#")]),t._v(" 1.2 子查询的基本使用")]),t._v(" "),a("ul",[a("li",[t._v("子查询的基本语法结构：")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/mysql/1554991054388.png",alt:"1554991054388"}})]),t._v(" "),a("ul",[a("li",[t._v("子查询（内查询）在主查询之前一次执行完成。")]),t._v(" "),a("li",[t._v("子查询的结果被主查询（外查询）使用 。")]),t._v(" "),a("li",[a("strong",[t._v("注意事项")]),t._v(" "),a("ul",[a("li",[t._v("子查询要包含在括号内")]),t._v(" "),a("li",[t._v("将子查询放在比较条件的右侧")]),t._v(" "),a("li",[t._v("单行操作符对应单行子查询，多行操作符对应多行子查询")])])])]),t._v(" "),a("h3",{attrs:{id:"_1-3-子查询的分类"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-子查询的分类"}},[t._v("#")]),t._v(" 1.3 子查询的分类")]),t._v(" "),a("p",[a("strong",[t._v("分类方式1：")])]),t._v(" "),a("p",[t._v("我们按内查询的结果返回一条还是多条记录，将子查询分为"),a("code",[t._v("单行子查询")]),t._v("、"),a("code",[t._v("多行子查询")]),t._v("。")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("单行子查询")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/mysql/1554991538719.png",alt:"1554991538719"}})])]),t._v(" "),a("li",[a("p",[t._v("多行子查询")])])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/mysql/1554991555669.png",alt:"1554991555669"}})]),t._v(" "),a("p",[a("strong",[t._v("分类方式2：")])]),t._v(" "),a("p",[t._v("我们按内查询是否被执行多次，将子查询划分为"),a("code",[t._v("相关(或关联)子查询")]),t._v("和"),a("code",[t._v("不相关(或非关联)子查询")]),t._v("。")]),t._v(" "),a("p",[t._v("子查询从数据表中查询了数据结果，如果这个数据结果只执行一次，然后这个数据结果作为主查询的条件进行执行，那么这样的子查询叫做不相关子查询。")]),t._v(" "),a("p",[t._v("同样，如果子查询需要执行多次，即采用循环的方式，先从外部查询开始，每次都传入子查询进行查询，然后再将结果反馈给外部，这种嵌套的执行方式就称为相关子查询。")]),t._v(" "),a("h2",{attrs:{id:"_2-单行子查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-单行子查询"}},[t._v("#")]),t._v(" 2. 单行子查询")]),t._v(" "),a("h3",{attrs:{id:"_2-1-单行比较操作符"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-单行比较操作符"}},[t._v("#")]),t._v(" 2.1 单行比较操作符")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("操作符")]),t._v(" "),a("th",[t._v("含义")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("=")]),t._v(" "),a("td",[t._v("equal to")])]),t._v(" "),a("tr",[a("td",[t._v(">")]),t._v(" "),a("td",[t._v("greater than")])]),t._v(" "),a("tr",[a("td",[t._v(">=")]),t._v(" "),a("td",[t._v("greater than or equal to")])]),t._v(" "),a("tr",[a("td",[t._v("<")]),t._v(" "),a("td",[t._v("less than")])]),t._v(" "),a("tr",[a("td",[t._v("<=")]),t._v(" "),a("td",[t._v("less than or equal to")])]),t._v(" "),a("tr",[a("td",[t._v("<>")]),t._v(" "),a("td",[t._v("not equal to")])])])]),t._v(" "),a("h3",{attrs:{id:"_2-2-代码示例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-代码示例"}},[t._v("#")]),t._v(" 2.2 代码示例")]),t._v(" "),a("p",[a("strong",[t._v("题目：查询工资大于149号员工工资的员工的信息")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/mysql/image-20210914232952626.png",alt:"image-20210914232952626"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/mysql/image-20210914232935062.png",alt:"image-20210914232935062"}})]),t._v(" "),a("p",[a("strong",[t._v("题目：返回job_id与141号员工相同，salary比143号员工多的员工姓名，job_id和工资")])]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" last_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" job_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" salary\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v("   employees\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v("  job_id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" job_id\n                 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v("   employees\n                 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v("  employee_id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("141")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("AND")]),t._v("    salary "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" salary\n                 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v("   employees\n                 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v("  employee_id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("143")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/mysql/1554991892770.png",alt:"1554991892770"}})]),t._v(" "),a("p",[a("strong",[t._v("题目：返回公司工资最少的员工的last_name,job_id和salary")])]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" last_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" job_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" salary\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v("   employees\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v("  salary "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("MIN")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("salary"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v("   employees"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/mysql/1554991935186.png",alt:"1554991935186"}})]),t._v(" "),a("p",[a("strong",[t._v("题目：查询与141号或174号员工的manager_id和department_id相同的其他员工的employee_id，manager_id，department_id")])]),t._v(" "),a("p",[t._v("实现方式1：不成对比较")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("SELECT  employee_id, manager_id, department_id\nFROM    employees\nWHERE   manager_id IN\n\t\t  (SELECT  manager_id\n                   FROM    employees\n                   WHERE   employee_id IN (174,141))\nAND     department_id IN\n\t\t  (SELECT  department_id\n                   FROM    employees\n                   WHERE   employee_id IN (174,141))\nAND\temployee_id NOT IN(174,141);\n")])])]),a("p",[t._v("实现方式2：成对比较")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("SELECT\temployee_id, manager_id, department_id\nFROM\temployees\nWHERE  (manager_id, department_id) IN\n                      (SELECT manager_id, department_id\n                       FROM   employees\n                       WHERE  employee_id IN (141,174))\nAND\temployee_id NOT IN (141,174);\n")])])]),a("h3",{attrs:{id:"_2-3-having-中的子查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-having-中的子查询"}},[t._v("#")]),t._v(" 2.3 HAVING 中的子查询")]),t._v(" "),a("ul",[a("li",[t._v("首先执行子查询。")]),t._v(" "),a("li",[t._v("向主查询中的HAVING 子句返回结果。")])]),t._v(" "),a("p",[a("strong",[t._v("题目：查询最低工资大于50号部门最低工资的部门id和其最低工资")])]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v("   department_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("MIN")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("salary"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v("     employees\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("GROUP")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("BY")]),t._v(" department_id\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("HAVING")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("MIN")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("salary"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n                       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("MIN")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("salary"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v("   employees\n                        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v("  department_id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h3",{attrs:{id:"_2-4-case中的子查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-case中的子查询"}},[t._v("#")]),t._v(" 2.4 CASE中的子查询")]),t._v(" "),a("p",[t._v("在CASE表达式中使用单列子查询：")]),t._v(" "),a("p",[a("strong",[t._v("题目：显式员工的employee_id,last_name和location。其中，若员工department_id与location_id为1800的department_id相同，则location为’Canada’，其余则为’USA’。")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("SELECT employee_id, last_name,\n       (CASE department_id\n        WHEN\n             (SELECT department_id FROM departments\n\t      WHERE location_id = 1800)\n        THEN 'Canada' ELSE 'USA' END) location\nFROM   employees;\n")])])]),a("h3",{attrs:{id:"_2-5-子查询中的空值问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-子查询中的空值问题"}},[t._v("#")]),t._v(" 2.5 子查询中的空值问题")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" last_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" job_id\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v("   employees\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v("  job_id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" job_id\n                 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v("   employees\n                 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v("  last_name "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Haas'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/mysql/1554992067381.png",alt:"1554992067381"}})]),t._v(" "),a("blockquote",[a("p",[a("strong",[t._v("子查询不返回任何行")])])]),t._v(" "),a("h3",{attrs:{id:"_2-5-非法使用子查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-非法使用子查询"}},[t._v("#")]),t._v(" 2.5 非法使用子查询")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" employee_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" last_name\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v("   employees\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v("  salary "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("MIN")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("salary"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v("     employees\n                 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("GROUP")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("BY")]),t._v(" department_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/mysql/1554992135819.png",alt:"1554992135819"}})]),t._v(" "),a("blockquote",[a("p",[a("strong",[t._v("多行子查询使用单行比较符")])])]),t._v(" "),a("h2",{attrs:{id:"_3-多行子查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-多行子查询"}},[t._v("#")]),t._v(" 3. 多行子查询")]),t._v(" "),a("ul",[a("li",[t._v("也称为集合比较子查询")]),t._v(" "),a("li",[t._v("内查询返回多行")]),t._v(" "),a("li",[t._v("使用多行比较操作符")])]),t._v(" "),a("h3",{attrs:{id:"_3-1-多行比较操作符"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-多行比较操作符"}},[t._v("#")]),t._v(" 3.1 多行比较操作符")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("操作符")]),t._v(" "),a("th",[t._v("含义")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("IN")]),t._v(" "),a("td",[t._v("等于列表中的"),a("strong",[t._v("任意一个")])])]),t._v(" "),a("tr",[a("td",[t._v("ANY")]),t._v(" "),a("td",[t._v("需要和单行比较操作符一起使用，和子查询返回的"),a("strong",[t._v("某一个")]),t._v("值比较")])]),t._v(" "),a("tr",[a("td",[t._v("ALL")]),t._v(" "),a("td",[t._v("需要和单行比较操作符一起使用，和子查询返回的"),a("strong",[t._v("所有")]),t._v("值比较")])]),t._v(" "),a("tr",[a("td",[t._v("SOME")]),t._v(" "),a("td",[t._v("实际上是ANY的别名，作用相同，一般常使用ANY")])])])]),t._v(" "),a("blockquote",[a("p",[t._v("体会 ANY 和 ALL 的区别")])]),t._v(" "),a("h3",{attrs:{id:"_3-2-代码示例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-代码示例"}},[t._v("#")]),t._v(" 3.2 代码示例")]),t._v(" "),a("p",[a("strong",[t._v("题目：返回其它job_id中比job_id为‘IT_PROG’部门任一工资低的员工的员工号、姓名、job_id 以及salary")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/mysql/1554992658876.png",alt:"1554992658876"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/mysql/1554992664594.png",alt:"1554992664594"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/mysql/1554992668429.png",alt:"1554992668429"}})]),t._v(" "),a("p",[a("strong",[t._v("题目：返回其它job_id中比job_id为‘IT_PROG’部门所有工资都低的员工的员工号、姓名、job_id以及salary")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/mysql/1554992753654.png",alt:"1554992753654"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/mysql/1554992759467.png",alt:"1554992759467"}})]),t._v(" "),a("p",[a("strong",[t._v("题目：查询平均工资最低的部门id")])]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#方式1：")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" department_id\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" employees\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("GROUP")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("BY")]),t._v(" department_id\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("HAVING")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("AVG")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("salary"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("MIN")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("avg_sal"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("AVG")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("salary"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" avg_sal\n\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" employees\n\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("GROUP")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("BY")]),t._v(" department_id\n\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" dept_avg_sal\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#方式2：")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" department_id\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" employees\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("GROUP")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("BY")]),t._v(" department_id\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("HAVING")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("AVG")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("salary"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ALL")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("AVG")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("salary"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" avg_sal\n\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" employees\n\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("GROUP")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("BY")]),t._v(" department_id\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("h3",{attrs:{id:"_3-3-空值问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-空值问题"}},[t._v("#")]),t._v(" 3.3 空值问题")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" last_name\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" employees\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v(" employee_id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("IN")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" manager_id\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" employees\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/mysql/image-20211027195906773.png",alt:"image-20211027195906773"}})]),t._v(" "),a("h2",{attrs:{id:"_4-相关子查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-相关子查询"}},[t._v("#")]),t._v(" 4. 相关子查询")]),t._v(" "),a("h3",{attrs:{id:"_4-1-相关子查询执行流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-相关子查询执行流程"}},[t._v("#")]),t._v(" 4.1 相关子查询执行流程")]),t._v(" "),a("p",[t._v("如果子查询的执行依赖于外部查询，通常情况下都是因为子查询中的表用到了外部的表，并进行了条件关联，因此每执行一次外部查询，子查询都要重新计算一次，这样的子查询就称之为"),a("code",[t._v("关联子查询")]),t._v("。")]),t._v(" "),a("p",[t._v("相关子查询按照一行接一行的顺序执行，主查询的每一行都执行一次子查询。")]),t._v(" "),a("img",{staticStyle:{zoom:"80%"},attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/mysql/1554992898234.png",alt:"1554992898234"}}),t._v(" "),a("img",{staticStyle:{zoom:"80%"},attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/mysql/1554992925281.png",alt:"1554992925281"}}),t._v(" "),a("p",[t._v("说明："),a("strong",[t._v("子查询中使用主查询中的列")])]),t._v(" "),a("h3",{attrs:{id:"_4-2-代码示例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-代码示例"}},[t._v("#")]),t._v(" 4.2 代码示例")]),t._v(" "),a("p",[a("strong",[t._v("题目：查询员工中工资大于本部门平均工资的员工的last_name,salary和其department_id")])]),t._v(" "),a("p",[a("strong",[t._v("方式一：相关子查询")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/mysql/1554992986225.png",alt:"1554992986225"}})]),t._v(" "),a("p",[a("strong",[t._v("方式二：在 FROM 中使用子查询")])]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" last_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("salary"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("e1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("department_id\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" employees e1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" department_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("AVG")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("salary"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" dept_avg_sal "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" employees "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("GROUP")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("BY")]),t._v(" department_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" e2\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v(" e1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("department_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" e2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("department_id\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("AND")]),t._v(" e2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dept_avg_sal "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" e1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("salary"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("blockquote",[a("p",[t._v("from型的子查询：子查询是作为from的一部分，子查询要用()引起来，并且要给这个子查询取别名，\n把它当成一张“临时的虚拟的表”来使用。")])]),t._v(" "),a("p",[t._v("在ORDER BY 中使用子查询：")]),t._v(" "),a("p",[a("strong",[t._v("题目：查询员工的id,salary,按照department_name 排序")])]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" employee_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("salary\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" employees e\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ORDER")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("BY")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n\t  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" department_name\n\t  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" departments d\n\t  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("department_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("department_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[a("strong",[t._v("题目：若employees表中employee_id与job_history表中employee_id相同的数目不小于2，输出这些相同id的员工的employee_id,last_name和其job_id")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("SELECT e.employee_id, last_name,e.job_id\nFROM   employees e\nWHERE  2 <= (SELECT COUNT(*)\n             FROM   job_history\n             WHERE  employee_id = e.employee_id);\n")])])]),a("h3",{attrs:{id:"_4-3-exists-与-not-exists关键字"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-exists-与-not-exists关键字"}},[t._v("#")]),t._v(" 4.3 EXISTS 与 NOT EXISTS关键字")]),t._v(" "),a("ul",[a("li",[t._v("关联子查询通常也会和 EXISTS操作符一起来使用，用来检查在子查询中是否存在满足条件的行。")]),t._v(" "),a("li",[a("strong",[t._v("如果在子查询中不存在满足条件的行：")]),t._v(" "),a("ul",[a("li",[t._v("条件返回 FALSE")]),t._v(" "),a("li",[t._v("继续在子查询中查找")])])]),t._v(" "),a("li",[a("strong",[t._v("如果在子查询中存在满足条件的行：")]),t._v(" "),a("ul",[a("li",[t._v("不在子查询中继续查找")]),t._v(" "),a("li",[t._v("条件返回 TRUE")])])]),t._v(" "),a("li",[t._v("NOT EXISTS关键字表示如果不存在某种条件，则返回TRUE，否则返回FALSE。")])]),t._v(" "),a("p",[a("strong",[t._v("题目：查询公司管理者的employee_id，last_name，job_id，department_id信息")])]),t._v(" "),a("p",[t._v("方式一：")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" employee_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" last_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" job_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" department_id\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v("   employees e1\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("EXISTS")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\n                 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v("   employees e2\n                 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v("  e2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("manager_id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("\n                        e1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("employee_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("方式二：自连接")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DISTINCT")]),t._v(" e1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("employee_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" e1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("last_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" e1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("job_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" e1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("department_id\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v("   employees e1 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("JOIN")]),t._v(" employees e2\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v(" e1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("employee_id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" e2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("manager_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("方式三：")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" employee_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("last_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("job_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("department_id\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" employees\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v(" employee_id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("IN")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n\t\t     "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DISTINCT")]),t._v(" manager_id\n\t\t     "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" employees\n\n\t\t     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[a("strong",[t._v("题目：查询departments表中，不存在于employees表中的部门的department_id和department_name")])]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" department_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" department_name\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" departments d\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("EXISTS")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'X'")]),t._v("\n                  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v("   employees\n                  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v("  department_id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("department_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/mysql/1554993169269.png",alt:"1554993169269"}})]),t._v(" "),a("h3",{attrs:{id:"_4-4-相关更新"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-相关更新"}},[t._v("#")]),t._v(" 4.4 相关更新")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("UPDATE")]),t._v(" table1 alias1\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SET")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("column")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" expression\n                 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v("   table2 alias2\n                 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v("  alias1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("column")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" alias2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("column")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("使用相关子查询依据一个表中的数据更新另一个表的数据。")]),t._v(" "),a("p",[a("strong",[t._v("题目：在employees中增加一个department_name字段，数据为员工对应的部门名称")])]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 1）")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ALTER")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" employees\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ADD")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("department_name VARCHAR2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 2）")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("UPDATE")]),t._v(" employees e\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SET")]),t._v(" department_name "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" department_name\n\t                       "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v("   departments d\n\t                       "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v("  e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("department_id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("department_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n")])])]),a("h3",{attrs:{id:"_4-4-相关删除"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-相关删除"}},[t._v("#")]),t._v(" 4.4 相关删除")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DELETE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" table1 alias1\n "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("column")]),t._v(" operator "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" expression\n                        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v("   table2 alias2\n                        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v("  alias1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("column")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" alias2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("column")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("使用相关子查询依据一个表中的数据删除另一个表的数据。")]),t._v(" "),a("p",[a("strong",[t._v("题目：删除表employees中，其与emp_history表皆有的数据")])]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DELETE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" employees e\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v(" employee_id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("in")]),t._v("\n           "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" employee_id\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v("   emp_history\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v("  employee_id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("employee_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h2",{attrs:{id:"_5-抛一个思考题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-抛一个思考题"}},[t._v("#")]),t._v(" 5. 抛一个思考题")]),t._v(" "),a("p",[t._v("**问题：**谁的工资比Abel的高？")]),t._v(" "),a("p",[a("strong",[t._v("解答：")])]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#方式1：自连接")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" e2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("last_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("e2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("salary\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" employees e1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("employees e2\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v(" e1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("last_name "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Abel'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("AND")]),t._v(" e1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("salary"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" e2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("salary"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("\n")])])]),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#方式2：子查询")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" last_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("salary\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" employees\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v(" salary "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" salary\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" employees\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v(" last_name "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Abel'")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("**问题：**以上两种方式有好坏之分吗？")]),t._v(" "),a("p",[t._v("**解答：**自连接方式好！")]),t._v(" "),a("p",[t._v("题目中可以使用子查询，也可以使用自连接。一般情况建议你使用自连接，因为在许多 DBMS 的处理过程中，对于自连接的处理速度要比子查询快得多。")]),t._v(" "),a("p",[t._v("可以这样理解：子查询实际上是通过未知表进行查询后的条件判断，而自连接是通过已知的自身数据表进行条件判断，因此在大部分 DBMS 中都对自连接处理进行了优化。")])])}),[],!1,null,null,null);s.default=n.exports}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[78],{451:function(t,s,a){"use strict";a.r(s);var e=a(46),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"_2-redis高级"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-redis高级"}},[t._v("#")]),t._v(" 2. Redis高级")]),t._v(" "),a("h2",{attrs:{id:"_2-1-redis-linux安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-redis-linux安装"}},[t._v("#")]),t._v(" 2.1 Redis Linux安装")]),t._v(" "),a("h4",{attrs:{id:"_047-linux安装redis"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_047-linux安装redis"}},[t._v("#")]),t._v(" 047-Linux安装redis")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CentOS7")]),t._v("安装"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Redis")]),t._v("\n\t下载安装包\n\t\twget http"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("download"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("io"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("releases"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("redis"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("?"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("?"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tar"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("gz\n\t解压\n\t\ttar "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("zxvf 文件名"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tar"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("gz\n\t编译\n\t\tmake\n\t安装\n\t\tmake install\n")])])]),a("h4",{attrs:{id:"_048-指定端口启动服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_048-指定端口启动服务"}},[t._v("#")]),t._v(" 048-指定端口启动服务")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("redis"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("server "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("port "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6380")]),t._v("\nredis"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("cli "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6380")]),t._v("\n")])])]),a("h4",{attrs:{id:"_049-指定配置文件启动服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_049-指定配置文件启动服务"}},[t._v("#")]),t._v(" 049-指定配置文件启动服务")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("过滤掉注释信息、过滤掉空白行，只留下有用的代码\n\tcat redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conf"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("grep "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("v "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"#"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("grep "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("v "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"^$"')]),t._v("\n\tcat redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conf "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("grep "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("v "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"#"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("grep "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("v "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"^$"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" redis"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379.")]),t._v("conf\n")])])]),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("我们的配置文件内容如下：redis"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379.")]),t._v("conf\n\n\tport "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("\n\n\t# 以守护进程方式启动，后台启动，启动时不在终端上打印日志信息\n\tdaemonize yes\n\n\t# 生成的日志文件的名字\n\tlogfile "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"6379.log"')]),t._v("\n\n\t# 生成的日志文件，放在哪个位置\n\tdir "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("usr"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("local"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("redis"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".6")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("log6379Data\n")])])]),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("以配置文件方式启动\n\tredis"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("server "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("usr"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("local"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("redis"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".6")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("redis"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379.")]),t._v("conf \t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//启动redis-server")]),t._v("\n\tredis"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("cli "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//client连接server")]),t._v("\n\tps "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("ef "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("grep redis"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("  \t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//查看redis-开头的所有进程")]),t._v("\n\tkill "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("s "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),t._v(" 进程号\t\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//杀死redis-server进程")]),t._v("\n")])])]),a("h4",{attrs:{id:"_050-配置文件启动目录管理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_050-配置文件启动目录管理"}},[t._v("#")]),t._v(" 050-配置文件启动目录管理")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("把redis"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379.")]),t._v("conf文件，放到专门的目录下方便管理 ， 放到conf文件夹下\n\t"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("usr"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("local"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("redis"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".6")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("conf"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("redis"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379.")]),t._v("conf\n")])])]),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("想再启动一个redis"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("server：redis"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379.")]),t._v("conf\n\n\tport "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6380")]),t._v("\n\n\t# 以守护进程方式启动，后台启动，启动时不在终端上打印日志信息\n\tdaemonize yes\n\n\t# 生成的日志文件的名字\n\tlogfile "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"6380.log"')]),t._v("\n\n\t# 生成的日志文件，放在哪个位置\n\tdir "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("usr"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("local"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("redis"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".6")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("conf"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("logData\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@lwh")]),t._v(" log6379Data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("# redis"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("server "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("usr"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("local"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("redis"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".6")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("conf"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("redis"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6380.")]),t._v("conf\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@lwh")]),t._v(" log6379Data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("# ps aux"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("grep redis\nroot      "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10560")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.2")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.2")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("153892")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2180")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Ssl")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("22")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("58")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("00")]),t._v(" redis"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("server "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6380")]),t._v("\nroot      "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10566")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("112712")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("964")]),t._v(" pts"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("S")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("22")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("58")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("00")]),t._v(" grep "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("color"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("auto redis\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@lwh")]),t._v(" log6379Data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("# redis"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("cli "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6380")]),t._v("\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//client连接server")]),t._v("\n")])])]),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("总结\n\t"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Redis")]),t._v("服务启动\n\t\t默认配互启动\n\t\t\tredis"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("server\n\t\t\tredis"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("server "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("port "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("\n\t\t\tredis"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("server "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("port "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6380")]),t._v("……\n\t\t指定配置文件启动\n\t\t\tredis"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("server redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conf\n\t\t\tredis"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("server redis"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379.")]),t._v("conf\n\t\t\tredis"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("server redis"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6380.")]),t._v("conf\n\t\t\tredis"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("server conf"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("redis"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v(" cont\n\t\t\tredis"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("server conf"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("redis"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6380.")]),t._v("conf……\n\t"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Redis")]),t._v("客户端连接\n\t\t默认连接\n\t\t\tredis"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("cli\n\t\t连接指定服务器\n\t\t\tredis"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("cli "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("h "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),t._v("\n\t\t\tredis"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("cli "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("\n\t\t\tredis"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("cli "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("h "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("\n\n配置文件模板：redis"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379.")]),t._v("conf\n\n\t# 设置当前服务器启动端口\n\tport "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("\n\n\t# 以守护进程方式启动，使用本启动方式，redis讲义服务的形式存在，日志将不再打印到命令窗口\n\tdaemonize yes\n\n\t# 设定日志文件名，便于查阅\n\tlogfile "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"6379.log"')]),t._v("\n\n\t# 设定当前服务文件保存的位置，包含日志文件、持久化文件等\n\tdir "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("usr"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("local"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("redis"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".6")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("conf"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("log6379Data\n")])])]),a("h2",{attrs:{id:"_2-2-持久化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-持久化"}},[t._v("#")]),t._v(" 2.2 持久化")]),t._v(" "),a("h3",{attrs:{id:"_2-2-1-持久化简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-1-持久化简介"}},[t._v("#")]),t._v(" 2.2.1 持久化简介")]),t._v(" "),a("h4",{attrs:{id:"_051-持久化-持久化简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_051-持久化-持久化简介"}},[t._v("#")]),t._v(" 051-持久化-持久化简介")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("持久化简介\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.")]),t._v(" 意外的断电、软件崩溃\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2.")]),t._v(" “自动备份”：其实就是将内存中的数据和硬盘中的数据做了一个关联\n什么是持久化\n\t利用永久性存储介质将数据进行保存，在特定的时间将保存的数据进行恢复的工作机制称为持久化\n为什么要进行持久化\n\t防止数据的意外丢失，确保数据安全性\n持久化过程保存什么\n\t将当前数据状态进行保存，快照形式，存储数据结果，存储格式简单，关注点在数据  \t\t\t数据"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("快照"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  RDB\n\t将数据的操作过程进行保存，日志形式，存储操作过程，存储格式复杂，关注点在数据的操作过程\t过程"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("日志"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  AOF\n")])])]),a("h3",{attrs:{id:"_2-2-2-rdb"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-2-rdb"}},[t._v("#")]),t._v(" 2.2.2 RDB")]),t._v(" "),a("h4",{attrs:{id:"_052-持久化-save指令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_052-持久化-save指令"}},[t._v("#")]),t._v(" 052-持久化-save指令")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("RDB启动方式\n\t谁、什么时间、干什么事情\n命令执行\n\t谁：redis操作者（用户）\n\t什么时间：即时（随时进行）\n\t干什么事情：保存数据\n")])])]),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("RDB启动方式—save指令\n命令\n\tsave\n作用\n\t手动执行一次保存操作\n")])])]),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" keys "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("empty list or set"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" set name zhangsan\nOK\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" save "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//手动执行保存指令")]),t._v("\nOK\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@lwh")]),t._v(" logData"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("# pwd\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("usr"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("local"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("redis"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".6")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("conf"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("logData "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//在设置好的文件保存目录下")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@lwh")]),t._v(" logData"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("# ll\ntotal "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("rw"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("r"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("r"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1455")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Apr")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("54")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379.l")]),t._v("og\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("rw"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("r"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("r"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("112")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Apr")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("54")]),t._v(" dump"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rdb\n\nXXX"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rdb就是持久化文件，保存了当前的快照信息\n")])])]),a("h4",{attrs:{id:"_053-持久化-rdb相关配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_053-持久化-rdb相关配置"}},[t._v("#")]),t._v(" 053-持久化-RDB相关配置")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("RDB启动方式—save指令相关配置\n\tdbfilename dump"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rdb\n\t\t说明：设置本地数据库文件名，默认值为 dump"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rdb\n\t\t经验：通常设为 dump"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("端口号"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rdb\n\tdir\n\t\t说明：设置存储"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rdb文件的路径\n\t\t经验：通常设置成存储空间较大的目录中，目录名称 data\n\trdbcompression yes\n\t\t说明：设置存储至本地数据库时是否压缩数据，默认为yes，采用LF压缩\n\t\t经验：通常默认为开启状态，如果设置为no，可以节省CPU运行时间，但会使存储的文件变大（巨大）\n\trdbchecksum yes\n\t\t说明：设置是否进行RDB文件格式校验，该校验过程在写文件和读文件过程均进行\n\t\t经验：通常默认为开启状态，如果设置为no，可以节约读写性过程约"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("时消耗，但是存储"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("恢复的数据有一定的损坏风险\n")])])]),a("p",[t._v("更改后的redis-6379.conf文件内容如下")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("# 设置当前服务器启动端口\nport "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("\n\n# 以守护进程方式启动，使用本启动方式，redis讲义服务的形式存在，日志将不再打印到命令窗口\ndaemonize yes\n\n# 设定日志文件名，便于查阅\nlogfile "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"6379.log"')]),t._v("\n\n# 设定当前服务文件保存的位置，包含日志文件、持久化文件等\ndir "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("usr"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("local"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("redis"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".6")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("conf"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("logData\n\n# 设置 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rdb文件名 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("RDB持久化文件名"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ndbfilename dump"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379.")]),t._v("rdb\n\n# 开启压缩"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("持久化文件"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nrdbcompression yes\n\n# 开启加载检测\nrdbchecksum yes\n")])])]),a("h4",{attrs:{id:"_054-持久化-数据恢复过程演示"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_054-持久化-数据恢复过程演示"}},[t._v("#")]),t._v(" 054-持久化-数据恢复过程演示")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("启动服务\n客户端连接服务端，并发送指令，并save\n\n关闭服务端\n启动客户端，启动服务端，并连接\nkeys "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\n发下，上一次存储的数据，都已经加载上来了"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("服务启动的时候，加载了"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rdb里的数据"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("h4",{attrs:{id:"_055-持久化-save指令工作原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_055-持久化-save指令工作原理"}},[t._v("#")]),t._v(" 055-持久化-save指令工作原理")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("RDB启动方式"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("save指令工作原理\n\n注意：\n\tsave指令的执行会阻塞当前"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Redis")]),t._v("服务器，直到当前RDB过程完成为止，有可能会造成长时间阻塞，线上环境不建议使用。\n\t"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" 线上环境中不建议使用save这种指令，因为很拉服务器的性能效率，有可能造成长时间的阻塞\n")])])]),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/redis/20200405144629553.png",alt:""}})]),t._v(" "),a("h4",{attrs:{id:"_056-持久化-bgsave指令与工作原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_056-持久化-bgsave指令与工作原理"}},[t._v("#")]),t._v(" 056-持久化-bgsave指令与工作原理")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("RDB启动方式\n\t数据量过大，单线程执行方式造成效率过低，如何处理？\n后台执行\n\t谁：redis操作者（用户）发起指令；reds服务器控制指令执行\n\t什么时间：即时（发起）；合理的时间（执行）\n\t干什么事情：保存数据\n")])])]),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("RDB启动方式— bgsave指令\n命令\n\tbgsave\n\t注释：bg"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("background\n作用\n\t手动启动后台保存操作，但不是立即执行\n")])])]),a("p",[t._v("RDB启动方式— bgsave指令工作原理")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" bgsave\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Background")]),t._v(" saving started\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/redis/2020040514595481.png",alt:""}}),t._v("\n查看我们的日志文件\n"),a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/redis/20200405150402629.png",alt:""}})]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("注意：\n\tbgsave命令是针对save阻塞问题做的优化，"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("save是马上执行，并且加入到任务执行序列中"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Redis")]),t._v("内部所有涉及到RDB操作都来用bgsave的方式，save命令可以放弃使用\n")])])]),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("RDB启动方式 — bgsave指令相关配置\n\tdbfilenane dump"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rdb\n\tdir\n\trdbcompression yes\n\trdbchecksum yes\n\tstop"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("writes"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("on"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("bgsave"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("error yes\n\t\t说明：后台存储过程中如果出现错误现象，是否停止保存操作\n\t\t经验：通常默认为开启状态\n")])])]),a("p",[t._v("redis-6379.conf配置文件 更新后")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("\t# 设置当前服务器启动端口\n\tport "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("\n\n\t# 以守护进程方式启动，使用本启动方式，redis讲义服务的形式存在，日志将不再打印到命令窗口\n\tdaemonize yes\n\n\t# 设定日志文件名，便于查阅\n\tlogfile "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"6379.log"')]),t._v("\n\n\t# 设定当前服务文件保存的位置，包含日志文件、持久化文件等\n\tdir "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("usr"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("local"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("redis"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".6")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("conf"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("logData\n\n\t# 设置 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rdb文件名 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("RDB持久化文件名"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\tdbfilename dump"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379.")]),t._v("rdb\n\n\t# 开启压缩"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("持久化文件"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\trdbcompression yes\n\n\t# 开启加载检测\n\trdbchecksum yes\n\n\t# bgsave后台存储过程中，如果出现错误现象，是否停止保存操作\n\tstop"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("writes"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("on"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("bgsave"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("error yes\n")])])]),a("h4",{attrs:{id:"_057-持久化-save配置与工作原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_057-持久化-save配置与工作原理"}},[t._v("#")]),t._v(" 057-持久化-save配置与工作原理")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("RDB启动方式\n\t反复执行保存指令，忘记了怎么办？不知道数据产生了多少变化，何时保存？\n自动执行\n\t谁：redis服务器发起指令（基于条件）\n\t什么时间：满足条件\n\t干什么事情：保存数据\n")])])]),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("RDB启动方式—save配置\n\t配置\n\t\tsave second changes\n\t作用\n\t\t满足 限定second的时间范围内 key的变化数量 达到 指定changes数量 即进行持久化\n\t参数\n\t\tsecond：监控时间范国\n\t\tchanges：监控key的变化量\n\t位置\n\t\t在conf文件中进行配置\n\t范例\n\t\tsave "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("900")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n\t\tsave "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("300")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("\n\t\tsave "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("60")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10000")]),t._v("\n")])])]),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/redis/20200405153058755.png",alt:""}})]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("注意：\n\tsave配要根据实际业务情兄进行设置，频度过高或过低都会出现性能问题，结果可能是灾难性的\n\tsave配置中对于second与changes设置通常具有互补对应关系，尽量不要设置成包含性关系\n\tsave配置启动后执行的是bgsave操作\n")])])]),a("p",[t._v("redis-6379.conf")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("\t# 设置当前服务器启动端口\n\tport "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("\n\n\t# 以守护进程方式启动，使用本启动方式，redis讲义服务的形式存在，日志将不再打印到命令窗口\n\tdaemonize yes\n\n\t# 设定日志文件名，便于查阅\n\tlogfile "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"6379.log"')]),t._v("\n\n\t# 设定当前服务文件保存的位置，包含日志文件、持久化文件等\n\tdir "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("usr"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("local"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("redis"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".6")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("conf"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("logData\n\n\t# 设置 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rdb文件名 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("RDB持久化文件名"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\tdbfilename dump"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379.")]),t._v("rdb\n\n\t# 开启压缩"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("持久化文件"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\trdbcompression yes\n\n\t# 开启加载检测\n\trdbchecksum yes\n\n\t# bgsave后台存储过程中，如果出现错误现象，是否停止保存操作\n\tstop"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("writes"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("on"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("bgsave"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("error yes\n\n\t# 指定时间内，key的更改达到指定的数量，"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Redis")]),t._v("自动进行gbsave操作\n\t# 此处设置的是每"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("300")]),t._v("s发生"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("次变化，就进行一次bgsave\n\t#save "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("900")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n\tsave "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("300")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("\n\t#save "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("60")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10000")]),t._v("\n")])])]),a("h4",{attrs:{id:"_058-持久化-rdb三种启动方式对比与优缺点分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_058-持久化-rdb三种启动方式对比与优缺点分析"}},[t._v("#")]),t._v(" 058-持久化-RDB三种启动方式对比与优缺点分析")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/redis/2020040515384687.png",alt:""}})]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("rdb特殊启动形式\n\t全复制\n\t\t在主从复制中详细讲解\n\t服务器运行过程中重启\n\t\tdebug reload\n\t关闭服务器时指定保有数据\n\t\tshutdown save "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//可以关闭redis-server")]),t._v("\n")])])]),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("RDB优点\n\tRDB是一个紧凑压缩的二进制文件，存效率较高\n\tRDB内部存储的是redis在某个时间点的数据快照，非常适合用于数据备份，全量复制等场景\n\tRDB恢复数据的速度要比AOF快很多\n\t应用：服务器中每"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("X")]),t._v("小时执行bgsave备份，并将RDB文件拷贝到远程机器中，用于灾难恢复\nRDB缺点\n\tRDB方式无论是执行指令还是利用五，无法到实时持久化，具有较大的可能性丢失数据\n\tbgsave指令每次运行要执行fork操作创建子进程，要牺牲掉一些性能\n\t"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Redis")]),t._v("的众多版本中未进行RDB文件格式的版本统一，有可能出现各版本服务之间数据格式无法兼容现象\n")])])]),a("h3",{attrs:{id:"_2-2-3-aof"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-3-aof"}},[t._v("#")]),t._v(" 2.2.3 AOF")]),t._v(" "),a("h4",{attrs:{id:"_059-持久化-aof简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_059-持久化-aof简介"}},[t._v("#")]),t._v(" 059-持久化-AOF简介")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("RDB存储的弊端\n\t存储数据量较大，效率较低\n\t\t基于快照思想，每次读写都是全部据，当数据量巨大时，效率非常低\n\t大数据量下的IO性能较低\n\t基于fok创建子进程，内存产生额外消耗\n\t宕机带来的数据丢失冈脸\n解决思路\n\t不写全数据，仅记录部分数据\n\t改记录数据为记录操作过程\n\t对所有操作均进行记录，排除丢失数据的风险\n")])])]),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("AOF概念\n\n\t"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("AOF")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("append only file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("持久化：以独立日志的方式记录每次写命令，\n\t重启时再重新执行AOF文件中的命令，达到恢复数据的目的。\n\t与RDB相比可以简单描述为 改记录数据 为 记录数据产生的过程\n\n\tAOF的主要作用是解决了数据持久化的实时性，目前已经是"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Redis")]),t._v("持久化的主流方式\n")])])]),a("h4",{attrs:{id:"_060-持久化-aof持久化策略基本操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_060-持久化-aof持久化策略基本操作"}},[t._v("#")]),t._v(" 060-持久化-AOF持久化策略基本操作")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/redis/20200405170350709.png",alt:""}}),t._v(" "),a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/redis/20200405181138897.png",alt:""}}),t._v(" "),a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/redis/20200405185724672.png",alt:""}})]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("AOF写数据三种策略（appendfsync）\n\t"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("always")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("每次"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t每次写入操作均同步到AOF文件中，数据零误差，性能较低，不建议使用\n\t"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("everysec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("每秒"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t毎秒将缓冲区中的指令同步到AOF文件中，数据准确性铰高，性能铰高，建议使用，也是默认配置\n\t\t在系统突然宕机的情况下丢失"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("秒内的数据\n\t"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("no")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("系统控制"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t由操作系统控制每次同步到AOF文件的周期，整体过程不可控\n")])])]),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("AOF功能开启\n\t配置\n\t\tappendonly yes"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("no\n\t作用\n\t\t是否开启AOF持久化功能，默认为不开启状态\n\t配置\n\t\tappendfsync always"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("everysec"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("no\n\t作用\n\t\tAOF写数据策略\n")])])]),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("AOF相关配置\n\t配置\n\t\tappendfilename filename\n\t作用\n\t\tAOF持久化文件名，默认文件名末 appendonly"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("aof，建议配置为 appendonly"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("端口号"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("aof\n\t配置\n\t\tdir\n\t作用\n\t\tAOF持久化文件保存路径，与RDB持久化文件保持一致即可\n")])])]),a("p",[t._v("redis-6379.conf")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("####################################################\n# 设置当前服务器启动端口\nport "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("\n\n# 以守护进程方式启动，使用本启动方式，redis讲义服务的形式存在，日志将不再打印到命令窗口\ndaemonize yes\n\n# 设定日志文件名，便于查阅\nlogfile "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"6379.log"')]),t._v("\n\n# 设定当前服务文件保存的位置，包含日志文件、持久化文件等\ndir "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("usr"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("local"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("redis"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".6")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("conf"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("logData\n\n####################################################\n# 设置 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rdb文件名 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("RDB持久化文件名"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ndbfilename dump"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379.")]),t._v("rdb\n\n# 开启压缩"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("持久化文件"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nrdbcompression yes\n\n# 开启加载检测\nrdbchecksum yes\n\n####################################################\n# bgsave后台存储过程中，如果出现错误现象，是否停止保存操作\nstop"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("writes"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("on"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("bgsave"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("error yes\n\n# 指定时间内，key的更改达到指定的数量，"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Redis")]),t._v("自动进行gbsave操作\n# 此处设置的是每"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("300")]),t._v("s发生"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("次变化，就进行一次bgsave\nsave "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("900")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\nsave "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("300")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("\nsave "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("60")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10000")]),t._v("\n\n####################################################\n# 开启对AOF的支持\nappendonly yes\n\n# 指定AOF写数据的策略\nappendfsync everysec\n\n# 设置AOF持久化文件名\nappendfilename appendonly"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379.")]),t._v("aof\n\n####################################################\n")])])]),a("h4",{attrs:{id:"_061-持久化-aof重写概念与命令执行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_061-持久化-aof重写概念与命令执行"}},[t._v("#")]),t._v(" 061-持久化-AOF重写概念与命令执行")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("AOF写数据遇到的问题\n\t如果连续执行如下指令该如何处理\n\t\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" set name zs\n\t\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" set name "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Is")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" set name wv "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//只有这一次最终生效 --\x3e 127.0.0.1:6379> set name ww")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" incr num\n\t\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Incr")]),t._v(" nun\n\t\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Incr")]),t._v(" nun    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//假设num刚开始不存在--\x3e 127.0.0.1:6379> set nun3")]),t._v("\n")])])]),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("AOF重写\n\t随着命令不断写入AOF，文件会越来越大，为了解决这个问题，"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Reds")]),t._v("引入了AOF重写机制压缩文件体积。\n\tAOF文件重写是将"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Redi")]),t._v("进程内的数据转化为写命令同步到新AOF文件的过程，简单说就是将对同一个数\n\t据的若干个条命令执行结果转化成最终结果数据对应的指令进行记录。\nAOF重写作用\n\t降低磁盘占用量，提高磁盘利用率\n\t提高持久化效率，降低寺久化写时间，提高"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("O")]),t._v("性能\n\t降低数据恢复用时，提高数据恢复效率\n")])])]),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("AOF重写规则\n\t进程内已超时的数据不再写入文件\n\t忽略无效指令，重写时使用进程内数据直接生成，这样新的AOF文件只保留最终数据的写入命令\n\t\t如del key1、 hdel key2、 srem key3、 set key4111、 set key4222等\n\t对同一数据的多条写命令合并为一条命令\n\t\t如 "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Push")]),t._v(" list1 a、 "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Push")]),t._v(" list1 b、 "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Push")]),t._v(" list1 c可以转化为："),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Push")]),t._v(" list1 a b c\n\t\t为防止数据量过大造成客户端缓冲区溢出，对list、set、hash、zset等类型，每条指令最多写入"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),t._v("个元素\n")])])]),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("AOF重写方式\n\t手动写\n\t\tbgrewriteaof\n\t自动重写\n\t\tauto"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("aof"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("rewrite"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("min"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("size size\n\t\tauto"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("aof"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("rewrite"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("percentage percentage\n")])])]),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/redis/20200406161450575.png",alt:""}})]),t._v(" "),a("h4",{attrs:{id:"_062-持久化-aof自动重写配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_062-持久化-aof自动重写配置"}},[t._v("#")]),t._v(" 062-持久化-AOF自动重写配置")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("AOF自动重写方式\n\t自动重写触发条件设置\n\t\tauto"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("aof"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("rewrite"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("min"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("size \t size \t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//配置的：aof自动重写的临界值")]),t._v("\n\t\tauto"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("aof"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("rewrite"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("percentage  percent\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//：aof自动重写的百分比")]),t._v("\n\t自动重写触发比对参数（运行指令 info "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Persistence")]),t._v("获取具体信息）\n\t\taof_current_size  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//aof缓存中，当前已经缓存了多少 ，当大于size时，就进行重写")]),t._v("\n\t\taof base size\n\t自动重写触发条件\n\t\taof_current_size"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("auto"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("aof"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("rewrite"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("min"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("size\n\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("aof_current_size"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("aof_base_size"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" aof_base_size "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" auto"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("aof"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("rewrite"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("percentage\n\nAOF自动重写方式\n\t自动重写触发条件设置：auto"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("aof"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("rewrite"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("min"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("size size "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//配置的：aof自动重写的临界值")]),t._v("\n\t自动重写触发比对参数：aof_current_size               "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//aof缓存中，当前已经缓存了多少 ，当大于size时，就进行重写")]),t._v("\n\t自动重写触发条件：aof_current_size"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("auto"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("aof"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("rewrite"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("min"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("size "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//当缓存大于size时，就进行重写")]),t._v("\nAOF自动重写方式\n\t自动重写触发条件设置：auto"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("aof"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("rewrite"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("percentage  percent\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//：aof自动重写的百分比")]),t._v("\n\t自动重写触发比对参数：aof_base_size\n\t自动重写触发条件："),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("aof_current_size"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("aof_base_size"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" aof_base_size "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" auto"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("aof"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("rewrite"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("percentage\n")])])]),a("h4",{attrs:{id:"_063-持久化-aof重写工作原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_063-持久化-aof重写工作原理"}},[t._v("#")]),t._v(" 063-持久化-AOF重写工作原理")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/redis/20200406164353511.png",alt:""}}),t._v(" "),a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/redis/20200406164409758.png",alt:""}}),t._v(" "),a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/redis/20200406164945942.png",alt:""}})]),t._v(" "),a("h3",{attrs:{id:"_2-2-4-rdb与aof区别"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-4-rdb与aof区别"}},[t._v("#")]),t._v(" 2.2.4 RDB与AOF区别")]),t._v(" "),a("h4",{attrs:{id:"_064-持久化-rdb与aof方案比对"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_064-持久化-rdb与aof方案比对"}},[t._v("#")]),t._v(" 064-持久化-RDB与AOF方案比对")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/redis/20200406165434983.png",alt:""}})]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("RDB与AOF的选择之惑\n\t对数据非常敏感，建议使用默认的AOF持久化方案\n\t\tAOF持久化策略使用 everysecond，每秒钟 fsync一次。该策略 redis仍可以保持很好的处理性能，当出现问题时，最多丢失"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("秒内的数据。\n\t\t注意：由于AOF文件存储体积较大，且恢复速度较慢\n\t数据呈现阶段有效性，建议使用RDB持久化方案\n\t\t数据可以良好的做到阶段内无丢失（该阶段是开发者或运维人员手工维护的），且恢复速度较快，阶段点数据恢复通常采用RDB方案\n\t\t注意：利用RDB实现紧凑的数据持久化会使 "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Redis")]),t._v("降的很低\n\t综合比对\n\t\tRDB与AOF的选择实际上是在做一种权衡，每种都有利有弊\n\t\t如不能承受数分钟以内的数据丢失，对业务数据非常敏感，选用AOF\n\t\t如能承受数分钟以内的数据丟失，且追求大数据集的恢复度，选用RDB\n\t\t灾难恢复选用RDB\n\t\t双保险策略，同时开启RDB和AOF，重启后， "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Redis")]),t._v("优先使用AOF来恢复数据，降低丟失数据的量\n")])])]),a("h3",{attrs:{id:"_2-2-5-持久化应用场景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-5-持久化应用场景"}},[t._v("#")]),t._v(" 2.2.5 持久化应用场景")]),t._v(" "),a("h4",{attrs:{id:"_065-持久化-持久化应用场景分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_065-持久化-持久化应用场景分析"}},[t._v("#")]),t._v(" 065-持久化-持久化应用场景分析")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Tips1")]),t._v("：redis用于控制数据库表主键id，为数据库表主键ID提供生成策略，保障教据库表的主键唯一性\n\t不建议使用持久化，因为可能导致ID重复\n\t直接从数据库中找到最大的那个ID，然后从ID"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("直接往下用就行了\n\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Tips2")]),t._v("：redis控制数据的生命周期，通过数据是否失效控制业务行为，适用于所有具有时效性限定控制的操作\n\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Tips3")]),t._v("：redis应用于各种结构型和非结构型高热度数据访问加速\n\t不使用持久化\n\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Tips4")]),t._v("：redis应用于购物车数据存储设计\n\t不使用持久化\n\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Tips5")]),t._v("：redis应用于抢购、限购类、限量发放优患卷、激活码等业务的数据存储设计\n\t对于这种快速存储，快速消失的数据\n\t建议使用持久化\n\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Tips6")]),t._v("：redis应用于具有操作先后顺序的数据控制\n\t对于这种临时的任务，如果量不是特别大的话，建议使用持久化\n\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Tips7")]),t._v("：redis应用于最新消息展示\n\t对于这种临时的任务，如果量不是特别大的话，建议使用持久化\n\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Tips8")]),t._v("：redis应用于随机推荐类信息检索，例如热点歌单推荐，热点新闻推荐，热卖旅游线路，应用APP推荐，大"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("V")]),t._v("推荐等\n\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Tips9")]),t._v("：redis应用于同类信息的关联搜索，一度关联搜索，深度关联搜索\n\t从"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MySQL")]),t._v("数据库里读取就行，不使用"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Redis")]),t._v("持久化\n\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Tips10")]),t._v("：redis应用于同类型不重复数据的合并、取交集操作\n\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Tips11")]),t._v("：redis应用于同类型数据的快速去重\n\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Tips12")]),t._v("：redis应用于基于黑名单与白名单设定的服务控制\n\t黑名单：长期策略的话，数据库里肯定要存储\n\t黑名单：不是长期策略，短期策略，建议使用"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Redis")]),t._v("持久化\n\t白名单：数据库里肯定有存储，一般不需要"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Redis")]),t._v("持久化\n\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Tips13")]),t._v("：redis应用于计数器组合排序功能对应的排名\n\t建议"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Redis")]),t._v("持久化\n\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Tips14")]),t._v("：redis应用于定时任务执行顺序管理或任务过期管理\n\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Tips15")]),t._v("：redis应用于及时任务"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("消息队列执行管理\n\t任务队列、消息队列：不建议使用\n\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Tips16")]),t._v("：redis应用于按次结算的服务控制\n\t不重要时，不使用\n\t重要，使用\n\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Tips17")]),t._v("：redis应用于基于时间顺序的数据操作，而不关注具体时间\n")])])]),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("总结\n\t"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Redis")]),t._v("持久化\n\t\t什么是持久化\n\t\tRDB\n\t\t\tsave \t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//save指令")]),t._v("\n\t\t\tbgsave \t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//bgsave指令")]),t._v("\n\t\t\t配置\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//使用的是bgsave")]),t._v("\n\t\tAOF\n\t\t\t持久化写策略"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//三种：always second")]),t._v("\n\t\t\t重写     "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//AOF文件会很大，所以要使用这种优化策略")]),t._v("\n")])])]),a("h2",{attrs:{id:"_2-3-事务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-事务"}},[t._v("#")]),t._v(" 2.3 事务")]),t._v(" "),a("h3",{attrs:{id:"_2-3-1-事务简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-1-事务简介"}},[t._v("#")]),t._v(" 2.3.1 事务简介")]),t._v(" "),a("h4",{attrs:{id:"_066-事务-redis事务简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_066-事务-redis事务简介"}},[t._v("#")]),t._v(" 066-事务-redis事务简介")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/redis/20200406174100684.png",alt:""}})]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("什么是事务\n\t"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Redis")]),t._v("执行指令过程中，多条连续执行的指令被干扰，打断，插队\n\n\t"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Redis")]),t._v("事务就是一个命令执行的队列，将一系列预定义命令，包装成一个整体（一个队列）。\n\t当执行时，一次性按照添加顺序依次执行，中间不会被断或者干扰\n\n\t一个队列中，一次性、顺序性、排他性的执行一系列命令\n")])])]),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/redis/20200406174312601.png",alt:""}}),t._v(" "),a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/redis/20200406174325262.png",alt:""}}),t._v(" "),a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/redis/20200406174408384.png",alt:""}})]),t._v(" "),a("h3",{attrs:{id:"_2-3-2-事务基本操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-2-事务基本操作"}},[t._v("#")]),t._v(" 2.3.2 事务基本操作")]),t._v(" "),a("h4",{attrs:{id:"_067-事务-事务的基本操作-定义-取消-执行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_067-事务-事务的基本操作-定义-取消-执行"}},[t._v("#")]),t._v(" 067-事务-事务的基本操作（定义，取消，执行）")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/redis/20200406174842390.png",alt:""}})]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("事务的基本操作\n\t开启事务\n\t\tmulti\n\t\t作用：设定事务的开启位置，此指令执行后，后续的所有指令均加入到事务中\n\t执行事务\n\t\texec\n\t\t作用：设定事务的结束位置，同时执行事务中所有的指令。与multi成对出现，成对使用\n\n\t注意：加入事务的命令暂时进入到任务队列中，并没有立即执行，只有执行exec命令才开始执行\n")])])]),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("争事务定义过程中发现出了问题，怎么办？\n\t取消事务\n\t\tdiscard\n\t\t作用：终止当前事务的定义，发生在multi之后，exec之前\n")])])]),a("h4",{attrs:{id:"_068-事务-事务的工作流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_068-事务-事务的工作流程"}},[t._v("#")]),t._v(" 068-事务-事务的工作流程")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/redis/20200406175855931.png",alt:""}}),t._v(" "),a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/redis/20200406180404134.png",alt:""}}),t._v(" "),a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/redis/20200406180428627.png",alt:""}}),t._v(" "),a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/redis/2020040618044545.png",alt:""}}),t._v(" "),a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/redis/20200406180504231.png",alt:""}}),t._v(" "),a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/redis/20200406180518129.png",alt:""}})]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("当事务中遇到discard指令时\n")])])]),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/redis/20200406180633856.png",alt:""}}),t._v(" "),a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/redis/20200406180642445.png",alt:""}})]),t._v(" "),a("h4",{attrs:{id:"_069-事务-事务操作的注意事项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_069-事务-事务操作的注意事项"}},[t._v("#")]),t._v(" 069-事务-事务操作的注意事项")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("定义事务的过程中，命令格式输入错误怎么办？\n\t语法错误：命令书写格式有误\n\t处理结果：如果定义的事务中所包含的命令存在语法错误，整体事务中所有命令均不会执行。包括那些语法正确的命令。\n")])])]),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("定义事务的过程中，命令执行出现错误怎么办？\n\t运行错误：命令格式正确"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("但是指令的语法错误"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("，无法正确的执行。例对list进行incr操作\n\t处理结果：能够正确运行的命令会执行，运行错误的命令不会被执行\n\t注意：已经执行完毕的命令对应的数据不会自动回滚，需要程序员自己在代码中实现回滚。\n")])])]),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("手动进行事务回滚\n\t记录操作过程中被影响的数据之前的状态\n\t\t单数据：string\n\t\t多数据：hash、list、set、zset\n\t设置指令恢复所有的被修改的项\n\t\t单数据：直接set（注意周边属性，例如时效）\n\t\t多数据：修改对应值或整体克隆复制\n")])])]),a("h3",{attrs:{id:"_2-3-3-锁"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-3-锁"}},[t._v("#")]),t._v(" 2.3.3 锁")]),t._v(" "),a("h4",{attrs:{id:"_070-事务-锁"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_070-事务-锁"}},[t._v("#")]),t._v(" 070-事务-锁")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("基于特定条件的事务执行\n\t业务场景\n\t\t天猫双"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),t._v("热卖过程中，对已经售罄的货物追加补货，"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("个业务员都有权限进行补货。\n\t\t补货的操作可能是一系列的操作，牵扯到多个连续操作，如何保障不会重复操作？\n\t业务分析\n\t\t多个客户端有可能同时操作同一组数据，并且该数据一旦被操作修改后，将不适用于继续操作\n\t\t在操作之前锁定要操作的数据，一旦发生变化，终止当前操作\n")])])]),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("基于特定条件的事务执行—锁\n\t解决方案\n\t\t对key添加监视锁，在执行exec前如果key发生了变化，终止事务执行\n\t\t\twatch key1 key2……   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//在开启事务之前去watch")]),t._v("\n\t\t取消对所有key的监视\n\t\t\tunwatch\n\twatch指令监控的东西一旦发生改变，下面定义的事务就不会再执行了\n")])])]),a("h3",{attrs:{id:"tips-18"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#tips-18"}},[t._v("#")]),t._v(" Tips 18：")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Tips")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),t._v("：\n\tredis应用于 基于状态控制的 批量任务执行\n")])])]),a("h4",{attrs:{id:"_071-事务-分布式锁"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_071-事务-分布式锁"}},[t._v("#")]),t._v(" 071-事务-分布式锁")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("基于特定条件的事务执行\n\t业务场景\n\t\t天猫双"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),t._v("热卖过程中，对已经售罄的货物追加补货，且补货完成。客户购买热情高涨，"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("秒内将所有商\n\t\t品购买完毕。本次补货已经将库存全部清空，如冋避免最后一件商品不被多人同时购买？【超卖问题】\n\t业务分析\n\t\t使用 watch监控一个key有没有改变已经不能解决问题，此处要监控的是具体数据\n\t\t虽然 "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Redis")]),t._v("是单线程的，但是多个客户端对同一数据同时进行操作时，如何避兔不被同时修改？\n")])])]),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("基于特定条件的事务执行—分布式锁\n\t解决方案\n\t\t使用 setnx设置一个公共锁\n\t\t\tsetnx lock"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Key")]),t._v(" va⊥ue\n\t\t利用setnx命令的返回值特征，有值则返回设置失败，无值则返回设置成功\n\t\t\t对于返回设置成功的，拥有控制权，进行下一步的具体业务操作\n\t\t\t对于返回设置失败的，不具有控制权，排队或等待\n\t\t操作完毕通过del操作释放锁\n\n\t注意：上述解决方案是一种设计概念，依赖规范"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("大家操作的是同一把锁"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("保障，具有风险性\n")])])]),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/redis/20200406221643360.png",alt:""}})]),t._v(" "),a("h3",{attrs:{id:"tips-19"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#tips-19"}},[t._v("#")]),t._v(" Tips 19")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Tips")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("19")]),t._v("\n\tredis应用：基于分布式锁 对应的场景控制\n")])])]),a("h4",{attrs:{id:"_072-事务-死锁解决方案"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_072-事务-死锁解决方案"}},[t._v("#")]),t._v(" 072-事务-死锁解决方案")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/redis/20200406221854440.png",alt:""}}),t._v(" "),a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/redis/20200406221905255.png",alt:""}})]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("上图：上着厕所的人，上锁了，但是睡着了，那外面等待的人得有多崩溃啊\n实际：上锁了，正用着呢，但是宕机了；或者忘记打开了\n")])])]),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("基于特定条件的事务执行\n\t业务场景\n\t\t依赖分布式锁的机制，某个用户操作时，对应的客户端宕机，且此时已经获取到锁。如何解决？\n\t业务分析\n\t\t由于锁操作由用户控制加锁解锁，必定会存在加锁后未解锁的风险\n\t\t需要解锁操作不能仅依赖用户控制，系统級别要给出对应的保底处理方案\n")])])]),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("基于特定条件的事务执行—分布式锁改良\n\t解决方案\n\t\t使用 expire为锁key添加时间限定"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("时效，到时不释放，放弃锁\n\t\t\texpire lock"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("key second\n\t\t\tpexpire lock"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("key milliseconds\n\t\t由于操作通常都是微秒或毫秒级，因此该锁定时间不宜设置过大。具体时间需要业务测试后确认\n\t\t\t例如：持有锁的操作最长执行时间"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127")]),t._v("ms，最短执行时间"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v("ms\n\t\t\t测试百万次最长执行时间对应命令的最大耗时，测试百万次网络延迟平均耗时\n\t\t\t锁时间设定推荐：最大耗时"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("120")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("平均网络延迟"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("110")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("\n\t\t\t如果业务最大耗时 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" 网络平均延迟，"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("通常为"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("个数量级"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("，取其中单个耗时较长即可\n")])])]),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" set name "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("123")]),t._v("\nok\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" setnx lock"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("name "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\ninteger"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" expire lock"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("name "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v("\ninteger"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" get name\n"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"123"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" del lock"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("name\ninteger"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),a("h2",{attrs:{id:"_2-4-删除策略"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-删除策略"}},[t._v("#")]),t._v(" 2.4 删除策略")]),t._v(" "),a("h3",{attrs:{id:"_2-4-1-过期数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-1-过期数据"}},[t._v("#")]),t._v(" 2.4.1 过期数据")]),t._v(" "),a("h4",{attrs:{id:"_073-删除策略-过期数据的概念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_073-删除策略-过期数据的概念"}},[t._v("#")]),t._v(" 073-删除策略-过期数据的概念")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Redis")]),t._v("中的数据特征\n\t"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Redis")]),t._v("是一种内存级数据库，所有数据均存放在内存中，内存中的数据可以通过TTL指令获取其状态\n\t\tXX：具有时效性的数据\n\t\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("：永久有效的数据\n\t\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("：已经过期的数据 或 被删除的数据 或 未定义的数据\n\t过期的数据真的删除了吗？\n")])])]),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/redis/20200407093309614.png",alt:""}}),t._v(" "),a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/redis/20200407093318815.png",alt:""}})]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("过期数据删除策略\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.")]),t._v("定时删除\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2.")]),t._v("惰性删除\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3.")]),t._v("定期删除\n")])])]),a("h3",{attrs:{id:"_2-4-2-数据删除策略"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-2-数据删除策略"}},[t._v("#")]),t._v(" 2.4.2 数据删除策略")]),t._v(" "),a("h4",{attrs:{id:"_074-删除策略-过期数据的底层存储结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_074-删除策略-过期数据的底层存储结构"}},[t._v("#")]),t._v(" 074-删除策略-过期数据的底层存储结构")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/redis/20200407093845423.png",alt:""}})]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("过期数据删除策略的目标\n\t在内存占用与CPU占用之间寻找一种平衡，\n\t顾比失彼都会造成整体redis性能的下降，甚至引发服务器宕机或内存泄露\n")])])]),a("h4",{attrs:{id:"_075-删除策略-定时删除与惰性删除"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_075-删除策略-定时删除与惰性删除"}},[t._v("#")]),t._v(" 075-删除策略-定时删除与惰性删除")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/redis/20200407094639869.png",alt:""}}),t._v(" "),a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/redis/2020040709465084.png",alt:""}}),t._v(" "),a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/redis/20200407094659838.png",alt:""}})]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("过期数据删除策略\n\t定时删除\n\t\t创建一个定时器，当key设置有过期时间，且过期时间到达时，由定时器任务立即执行对键的删除操作\n\t\t优点：节约内存，到时就删除，快速释放掉不必要的内存占用\n\t\t缺点：CPU压力很大，无论CPU此时负载量多高，均占用CPU，会影响edis服务器响应时间和指令吞吐量\n\t\t总结：用处理器性能换取存储空间"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("拿时间换空间"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("即 拿CPU换内存"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/redis/20200407095219427.png",alt:""}}),t._v(" "),a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/redis/20200407095231405.png",alt:""}}),t._v(" "),a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/redis/20200407095241546.png",alt:""}}),t._v(" "),a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/redis/20200407095255768.png",alt:""}})]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("数据删除策略\n\t惰性删除\n\t\t数据到达过期时间，不做处理。等下次访问该数据时\n\t\t\t如果未过期，返回数据\n\t\t\t发现已过期，删除，返回不存在\n\t\t优点：节约CPU性能，发现必须删除的时候才删除\n\t\t缺点：内存压力很大，出现长期占用内存的数据\n\t\t总结：用存储空间换取处理器性能"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("拿空间换时间"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("即 拿内存换CPU"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("h4",{attrs:{id:"_076-删除策略-定期删除"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_076-删除策略-定期删除"}},[t._v("#")]),t._v(" 076-删除策略-定期删除")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/redis/20200407101130547.png",alt:""}})]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("定期删除\n\t周期性轮询 "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Redis")]),t._v("库中的时效性数据，采用随机抽取的策略，利用过期数据占比的方式控制删除频度\n\t特点"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("：CPU性能占用设置有峰值，检测频度可自定义设置\n\t特点"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("：内存压力不是很大，长期占用内存的冷数据会被持续清理\n\t总结：周期性抽查存储空间（随机抽查，重点抽查）\n")])])]),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("删除策略比对\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.")]),t._v("定时删除\n\t\t节约内存，无占用\t\t不分时段占用CPU资源，频度高\t\t\t拿时间换空间\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2.")]),t._v("惰性删除\n\t\t内存占用严重\t\t\t延时执行，CPU可利用率高\t\t\t\t拿空间换时间\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3.")]),t._v("定期删除\n\t\t内存定期随机清理\t\t每秒花费固定的CPU资源维护内存\t\t随机抽查，重点抽查\n")])])]),a("h3",{attrs:{id:"_2-4-3-逐出算法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-3-逐出算法"}},[t._v("#")]),t._v(" 2.4.3 逐出算法")]),t._v(" "),a("h4",{attrs:{id:"_077-删除策略-逐出策略"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_077-删除策略-逐出策略"}},[t._v("#")]),t._v(" 077-删除策略-逐出策略")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("逐出算法\n\t新数据进入检测\n\t\t当新数据进入redis时，如果内存不足怎么办？\n\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Redis")]),t._v("使用内存存储数据，在执行每一个命令前，会调用"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("freeMemoryIfNeeded")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("检测内存是否充足。\n\t\t\t如果内存不满足新加入数据的最低存储要求，redis要临时删除一些数据为当前指令凊理存储空间。清理数据的策略称为逐出算法。\n\n\t\t\t注意：逐出数据的过程不是"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("能够清理出足够的可使用的内存空间，如果不成功则反复执行。\n\t\t\t当对所有数据尝试完毕后，如果不能达到内存清理的要求，将出现错误信息。\n\n\t\t\t（error）OOM command not allowed when used memory "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'maxmemory'")]),t._v("\n")])])]),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("影响数据逐出的相关配置\n\t最大可使用内存\n\t\tmaxmemory\n\t\t占用物理内存的比例，默认值为"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("，表示不限制。生产环境中根据需求设定，通常设置在"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("以上\n\t每次选取待删除数据的个数\n\t\tmaxmemory"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("samples\n\t\t选取数据时并不会全库扫描，导致严重的性能消耗，降低读写性能。因此采用随机获取数据的方式作为待检测删除数据\n\t删除策略\n\t\tmaxmemory"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("policy\n\t\t达到最大內存后的，对被挑选出来的数据进行删除的策略\n")])])]),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("影响数据逐出的相关配置\n\t检测易失数据（可能会过期的数据集 server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("db"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("expires）\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("volatile")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("lru：挑选最近最少使用的数据淘汰\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("volatile")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("lfu：挑选最近使用次数最少的数据淘汰\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("volatile")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("ttl：挑选将要过期的数据淘汰\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("volatile")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("random：任意选择数据匋汰\n\n\t\tLRU"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Least")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Recently")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Used")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v(" 最近，"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'最长时间没使用'")]),t._v("的"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("规定时间内"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\tLFU "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Least")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Frequently")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Used")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" 最近，"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'最少使用次数'")]),t._v("的"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("规定时间内"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\t检测全库数据（所有数据集 server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("db"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dict）\n\t\tallkeys"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("lru：挑选最近最少使用的数据淘汰\n\t\tallkeys"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("lfu：挑选最近使用次数最少的数据淘汰\n\t\tallkeys"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("random：任意选择数据淘汰\n\t放弃数据驱逐\n\t\tno"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" eviction（驱逐）：禁止驱逐数据倨（redis4"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("中默认策略），会引发错误OOM（"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Out")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Of")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Memory")]),t._v("）\n")])])]),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conf配置文件中"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("配置逐出策略\n\t\tmaxmemory"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("policy "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("volatile")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("lru\n")])])]),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("数据逐出策略配置依据\n\t使用info命令输出监控信息，查询缓存hit和miss的次数，根据业务需求调优"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Redis")]),t._v("配置\n")])])]),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Redis")]),t._v("删除策略\n\t数据删除策略"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("过期数据"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t定时刪除\n\t\t惰性删除\n\t\t定期删除\n\t数据逐出策略"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("时效性数据和永久性数据"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v("种策略\n\n\t加速运行效率\n\t\t减少无效的key的存储\n\t\t为我们释放出一些更加有用的空间来\n\t\t达到数据的快速操作与利用\n\n\t平衡是你需要把握的核心操作\n")])])]),a("h2",{attrs:{id:"_2-5-redis-conf"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-redis-conf"}},[t._v("#")]),t._v(" 2.5 redis.conf")]),t._v(" "),a("h4",{attrs:{id:"_078-服务器配置-redis-conf配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_078-服务器配置-redis-conf配置"}},[t._v("#")]),t._v(" 078-服务器配置-redis.conf配置")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("服务器基础配置\n\t服务器端设定\n\t\t设置服务器以守护进程的方式运行\n\t\t\tdaemonize yes"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("no\n\t\t绑定主机地址\n\t\t\tbind "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),t._v("\n\t\t设置服务器端口号\n\t\t\tport "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("\n\t\t设置数据库数量\n\t\t\tdatabases "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v("\n\n\t日志配置\n\t\t设置服务器以指定日志记录级别\n\t\t\tloglevel debug"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("verbose"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("notice"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("warning\n\t\t日志记录文件名\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("ogfi1e端囗号"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),t._v("og\n\t\t注意：日志级别\n\t\t\t\t开发期设互为 verbose即可，\n\t\t\t\t生产环境"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("上线运行的"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("中配互为 notice，简化日志输出量，降低写日志IO的频度\n\n\t客户端配置\n\t\t设置同一时间最大客户端连接数，默认无限制。当客户端连接到达上限， "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Redis")]),t._v("会关闭新的连接，"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("表示不限制上限\n\t\t\tmaxclients "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n\t\t客户端闲置等待最大时长，达到最大值后关闭连接。如需关闭该功能，设置为"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("。 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("多长时间不用，自动断掉与client的连接"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t\ttimeout "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("300")]),t._v("\n\n\t多服务器快捷配置\n\t\t导入并加载指定配置文件信息，用于快速创建redis公共配置较多的redis实例配置文件，便于维护  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("有点类似于继承，用于加速配置"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t相对路径用的比较多，绝对路径用的少一些\n\t\t主的配置文件，起一个特殊的名字；其他的用端口号起名字就行了\n\t\t\tinc1ude  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("path"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" server"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("端口号"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conf\n")])])]),a("p",[t._v("redis-6379.conf")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("####################################################\n#绑定IP\nbind "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),t._v("\n\n# 设置当前服务器启动端口\nport "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("\n\n# 数据库个数\ndatabases "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v("\n\n# 以守护进程方式启动，使用本启动方式，redis讲义服务的形式存在，日志将不再打印到命令窗口\ndaemonize yes\n\n# 设定日志文件名，便于查阅\nlogfile "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"6379.log"')]),t._v("\n\n# 设定当前服务文件保存的位置，包含日志文件、持久化文件等\ndir "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("usr"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("local"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("redis"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".6")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("conf"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("logData\n\n####################################################\n# 设置 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rdb文件名 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("RDB持久化文件名"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ndbfilename dump"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379.")]),t._v("rdb\n\n# 开启压缩"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("持久化文件"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nrdbcompression yes\n\n# 开启加载检测\nrdbchecksum yes\n\n####################################################\n# bgsave后台存储过程中，如果出现错误现象，是否停止保存操作\nstop"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("writes"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("on"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("bgsave"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("error yes\n\n# 指定时间内，key的更改达到指定的数量，"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Redis")]),t._v("自动进行gbsave操作\n# 此处设置的是每"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("300")]),t._v("s发生"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("次变化，就进行一次bgsave\nsave "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("900")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\nsave "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("300")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("\nsave "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("60")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10000")]),t._v("\n\n####################################################\n# 开启对AOF的支持\nappendonly yes\n\n# 指定AOF写数据的策略\nappendfsync everysec\n\n# 设置AOF持久化文件名\nappendfilename appendonly"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379.")]),t._v("aof\n\n####################################################\n")])])]),a("h2",{attrs:{id:"_2-6-高级数据类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-高级数据类型"}},[t._v("#")]),t._v(" 2.6 高级数据类型")]),t._v(" "),a("h3",{attrs:{id:"_2-6-1-bitmaps"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-1-bitmaps"}},[t._v("#")]),t._v(" 2.6.1 Bitmaps")]),t._v(" "),a("h4",{attrs:{id:"_079-高级数据类型-bitmaps介绍与基本操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_079-高级数据类型-bitmaps介绍与基本操作"}},[t._v("#")]),t._v(" 079-高级数据类型-bitmaps介绍与基本操作")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("bitmaps\n\t并不是一个全新的数据类型\n\t只是对string中存储对的数，进行二进制位"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("即 以字节为单位进行操作"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("操作的接口\n\t作用：快速的做状态统计用的，用bit保存数据\n")])])]),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Bitmaps")]),t._v("类型的基础操作\n\t获取指定key对应偏移量上的bit值\n\t\tgetbit key offset\n\t设置指定key对应偏移量上的bit值，value只能是"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("或"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n\t\tsetbit key offset valuea\n")])])]),a("h4",{attrs:{id:"_080-高级数据类型-bitmaps扩展操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_080-高级数据类型-bitmaps扩展操作"}},[t._v("#")]),t._v(" 080-高级数据类型-bitmaps扩展操作")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Bitmaps")]),t._v("类型的扩展操作\n\t业务场景\n\t电影网站\n\t\t统计每天某一部电影是否被点播\n\t\t统计每天有多少部电被点播\n\t\t统计每周"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("月"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("年有多少部电影被点播\n\t\t统计年度哪部电彯没有被点播\n")])])]),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/redis/20200407182935472.png",alt:""}})]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Bitmaps")]),t._v("类型的扩展操作\n\t对指定key按位进行交、并、非、异或操作，并将结果保存到 deskey中\n\t\tbitop operator deskey key1 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\t\t\toperator 类型：\n\t\t\t\tand：交\n\t\t\t\tor：并\n\t\t\t\tnot：非\n\t\t\t\txor：异或\n\t\t\tdestkey：运算结果存放的地方\n\t统计指定key中"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("的数量 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("不填范围，就是统计全部的"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\tbitcount key "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("start end"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),a("h3",{attrs:{id:"tips-21"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#tips-21"}},[t._v("#")]),t._v(" Tips 21:")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Tips")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("21")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Redis")]),t._v("应用于 信息状态统计\n")])])]),a("h3",{attrs:{id:"_2-6-2-hyperloglog"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-2-hyperloglog"}},[t._v("#")]),t._v(" 2.6.2 HyperLogLog")]),t._v(" "),a("h4",{attrs:{id:"_081-高级数据类型-hyperloglog"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_081-高级数据类型-hyperloglog"}},[t._v("#")]),t._v(" 081-高级数据类型-HyperLogLog")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HyperLogLog")]),t._v("\n\t作用：统计不重复数据的数量\n\t作用：做基数统计的\n\n\t比如：统计独立UV\n\t\t原始方案：set\n\t\t\t存储每个用户的id（字符串）\n\t\t改进方案："),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Bitmaps")]),t._v("\n\t\t\t存储每个用户状态（bit）\n\t\t全新的方案："),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Hyperloglog")]),t._v("\n")])])]),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("基数\n\t基数就是数据集合去重后元素的个数\n\t"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HyperLogLog")]),t._v("是用来做基数统计的，运用了"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("LogLog")]),t._v("算法\n")])])]),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/redis/20200407184551242.png",alt:""}}),t._v(" "),a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/redis/20200407184829590.png",alt:""}}),t._v(" "),a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/redis/20200407184840233.png",alt:""}})]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HyperLogLog")]),t._v("类型的基本操作\n\t添加数据\n\t\tpfadd key element "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("element "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\t统计数据\n\t\tpfcount key "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\t合并数据\n\t\tpfmerge deskey sourcekey "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("sourcekey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Tips")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("22")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Redis")]),t._v(" 应用于独立信息统计\n")])])]),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HyperLogLog")]),t._v("相关说明\n\t用于进行基数统计，不是集合，不保存数据，只记录数量而不是具体数据\n\t核心是基数估算算法，最终数值存在一定误差\n\t误差范围：基数估计的结果是一个带有"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.81")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("标准错误的近似值\n\t耗空间极小，每个hyperloglog key占用了"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v("K的内存用于标记基数\n\tpfadd命令不是一次性分配"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v("K内存使用，会随着基数的增加内存逐渐増大\n\tpfmerge命令合并后占用的存储空间为"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v("K，无论合并之前数据量多少\n")])])]),a("h3",{attrs:{id:"_2-6-3-geo"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-3-geo"}},[t._v("#")]),t._v(" 2.6.3 GEO")]),t._v(" "),a("h4",{attrs:{id:"_082-高级数据类型-geo"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_082-高级数据类型-geo"}},[t._v("#")]),t._v(" 082-高级数据类型-GEO")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("\t作用：根据点的位置"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("经纬度"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("，计算点之间的距离等\n\t作用：做地理位置信息计算的\n\n\tGEO类型的基本操作\n\t\t添加坐标点\n\t\t\tgeoadd key longitude latitude member "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("longitude latitude member "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\t\t\t       key 把这些点放到一个容器中\n\t\t\t       longitude  latitude  经纬度信息\n\t\t\t       member 这个点的名称\n\t\t获取坐标点\n\t\t\tgeopos key member "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("member "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\t\t计算坐标点距离\n\t\t\tgeodist key member member2 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("unit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\t\t\t\tunit：单位  m"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("米 km"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("千米\n\n\t\t根据坐标求范围内的数据"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("指定范围内有多少个点"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t\tgeoradius key longitude latitude radius m"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("km"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("ft"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("mi "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("withcoord"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("withdist"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("withhash"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("count count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\t\t根据点求范围内数据\n\t\t\tgeoradiusbymember key member radius m"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("km"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("ft"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("mi "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("withcoord"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("withdist"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("withhash"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("count count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\t\t获取指定点对应的坐标hash值\n\t\t\tgeohash key member "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("member"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),a("h3",{attrs:{id:"tips-23"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#tips-23"}},[t._v("#")]),t._v(" Tips 23:")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Tips")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Redis")]),t._v("应用于 地理位置计算\n")])])])])}),[],!1,null,null,null);s.default=n.exports}}]);
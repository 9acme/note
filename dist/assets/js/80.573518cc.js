(window.webpackJsonp=window.webpackJsonp||[]).push([[80],{452:function(s,t,a){"use strict";a.r(t);var e=a(46),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"_4-redis企业级解决方案"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-redis企业级解决方案"}},[s._v("#")]),s._v(" 4.Redis企业级解决方案")]),s._v(" "),a("h2",{attrs:{id:"_4-1-缓存预热"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-缓存预热"}},[s._v("#")]),s._v(" 4.1 缓存预热")]),s._v(" "),a("h3",{attrs:{id:"_107-企业级解决方案-缓存预热"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_107-企业级解决方案-缓存预热"}},[s._v("#")]),s._v(" 107-企业级解决方案-缓存预热")]),s._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("“宕机”\n\t服务器启动后迅速宕机\n")])])]),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("问题排查"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("服务刚启动时，缓存中没有数据"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.")]),s._v("请求数量较高\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.")]),s._v("主从之间数据吞吐量较大，数据同步操作频度较高\n")])])]),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("解决方案\n\t前置准备工作：\n\t\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.")]),s._v("日常例行统计数据访问记录，统计访问频度较高的热点数据\n\t\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.")]),s._v("利用LRU数据删除策略，构建数据留存队列\n\t\t\t例如：storm与kafka配合\n\t准备工作：\n\t\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.")]),s._v("将统计结果中的数据分类，根据级别，redis优先加载级别较高的热点数据\n\t\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.")]),s._v("利用分布式多服务器同时进行数据读取，提速数据加载过程\n\t实施：\n\t\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.")]),s._v("使用脚本程序固定触发数据预热过程\n\t\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.")]),s._v("如果条件允许，使用了CDN（内容分发网络），效果会更好\n")])])]),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("总结\n\t缓存预热就是系统启动前，提前将相关的缓存数据直接加载到缓存系统。\n\t避免在用户请求的时候，先查询数据库，然后再将数据缓存的问题！用户直接查询事先被预热的缓存数据！\n")])])]),a("h2",{attrs:{id:"_4-2-缓存雪崩"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-缓存雪崩"}},[s._v("#")]),s._v(" 4.2 缓存雪崩")]),s._v(" "),a("h3",{attrs:{id:"_108-企业级解决方案-缓存雪崩"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_108-企业级解决方案-缓存雪崩"}},[s._v("#")]),s._v(" 108-企业级解决方案-缓存雪崩")]),s._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("数据库服务器崩溃（"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("）\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.")]),s._v("系统平稳运行过程中，忽然数据库连接量激增\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.")]),s._v("应用服务器无法及时处理请求\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.")]),s._v("大量"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("408")]),s._v("，"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),s._v("错误页面出现\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.")]),s._v("客户反复刷新页面获取数据\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.")]),s._v("数据库崩溃\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.")]),s._v("应用服务器崩溃\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.")]),s._v("重启应用服务器无效\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.")]),s._v("Redis服务器崩溃\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9.")]),s._v("Redis集群崩溃\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.")]),s._v("重启数据库后再次被瞬间流量放倒\n")])])]),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("问题排查\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.")]),s._v("在一个"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'较短'")]),s._v("的时间内，缓存中"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'较多'")]),s._v("的key"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'集中过期'")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.")]),s._v("此周期内请求访问过期的数据，redis末命中，redis向数据库获取数据\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.")]),s._v("数据库同时接收到大量的请求无法及时处理\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.")]),s._v("Redis大量请求被积压，开始出现超时现象\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.")]),s._v("数据库流量激增，数据库崩溃\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.")]),s._v("重启后仍然面对缓存中无数据可用\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.")]),s._v("Redis服务器资源被严重占用，"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Redis")]),s._v("服务器崩溃\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.")]),s._v("Redis集群呈现崩塌，集群瓦解\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9.")]),s._v("应用服务器无法及时得到数据响应请求，来自客户端的请求数量越来越多，应用服务器崩溃\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.")]),s._v("应用服务器，redis，数据库全部重启，效果不理想\n")])])]),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("问题分析\n\t短时间范围内\n\t大量key集中过期\n")])])]),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("解决方案（道）"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//道：针对问题怎么去设计")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.")]),s._v("更多的页面静态化处理\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.")]),s._v("构建多级缓存架构\n\t\t"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Nginx")]),s._v("缓存"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("redis缓存"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("ehcache缓存\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.")]),s._v("检测"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Mysql")]),s._v("严重耗时业务进行优化\n\t\t对数据库的瓶颈排查：例如超时查询、耗时较高事务等\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.")]),s._v("灾难预警机制\n\t\t监控redis服务器性能指标\n\t\t\t·CPU占用、CPU使用率\n\t\t\t·内存容量\n\t\t\t·查询平均响应时间\n\t\t\t·线程数\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.")]),s._v("限流、降级\n\t\t短时间范围内牺牲一些客户体验，限制一部分请求访问，降低应用服务器压力，待业务低速运转后再逐步放开访问\n")])])]),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("解决方案（术）"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//术：针对问题具体动用哪些东西才会解决它")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.L")]),s._v("RU与LFU切换\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.")]),s._v("数据有效期策略调整\n\t\t根据业务数据有效期进行分类错峰，"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("A")]),s._v("类"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("90")]),s._v("分钟，"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("B")]),s._v("类"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("分钟，"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("C")]),s._v("类"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("70")]),s._v("分钟\n\t\t过期时间使用固定时间"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("随机值的形式，稀释集中到期的key的数量\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.")]),s._v("超热数据使用永久key\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.")]),s._v("定期维护（自动"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("人工）\n\t\t对即将过期数据做访问量分析，确认是否延时，配合访问量统计，做热点数据的延时\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.")]),s._v("加锁\n\t\t慎用！\n")])])]),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("总结\n\t缓存雪崩就是瞬间过期数据量太大，导致对数据库服务器造成压力。\n\t如能够有效避免过期时间集中，可以有效解决雪崩现象的出现（约"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("40")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("），\n\t配合其他策略一起使用，并监控服务器的运行数据，根据运行记录做快速调整。\n")])])]),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/redis/20200410184451617.png",alt:""}}),s._v(" "),a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/redis/20200410184642472.png",alt:""}})]),s._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("客户端访问我们的系统的时候\n\t通过"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Nginx")]),s._v("服务器分发到我们的应用服务器\n\t\t应用服务器去redis中查找缓存数据\n\t\t\t命中，直接返回\n\t\t\t如果没有在redis中命中，就去"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MySQL")]),s._v("数据库中查找\n\t\t如果大量的key集中过期，"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Redis")]),s._v("中无法得到有效的命中，\n\t\t\t应用服务器就会向"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MySQL")]),s._v("数据库服务器发出大量的请求\n\t\t\t\t这种情况下，"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MySQL")]),s._v("数据库服务器压力就会很大\n\t\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("解决办法，把过期时间错开"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),a("h2",{attrs:{id:"_4-3-缓存击穿"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-缓存击穿"}},[s._v("#")]),s._v(" 4.3 缓存击穿")]),s._v(" "),a("h3",{attrs:{id:"_109-企业级解决方案-缓存击穿"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_109-企业级解决方案-缓存击穿"}},[s._v("#")]),s._v(" 109-企业级解决方案-缓存击穿")]),s._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("数据库服务器崩溃（"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("）\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.")]),s._v("系统平稳运行过程中\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.")]),s._v("数据库连接量瞬间激增\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.")]),s._v("Redis服务器无大量key过期\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.")]),s._v("Redis内存平稳，无波动\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.")]),s._v("Redis服务器CPU正常\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.")]),s._v("数据库崩溃\n")])])]),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("问题排查\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.")]),s._v("Redis中某个key过期，该key访问量巨大\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.")]),s._v("多个数据请求从服务器直接压到"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Redis")]),s._v("后，均末命中\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.")]),s._v("Redis在短时间内发起了大量对数据库中同一数据的访问\n")])])]),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("问题分析\n\t单个key高热数据\n\tkey过期\n")])])]),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("解决方案（术）\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.")]),s._v("预先设定\n\t\t以电商为例，每个商家根据店铺等级，指定若干款主打商品，在购物节期间，加大此类信息key的过期时长\n\t\t注意：购物节不仅仅指当天，以及后续若干天，访问峰值呈现逐渐降低的趋势\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.")]),s._v("现场调整\n\t\t监控访问量，对自然流量激增的数据延长过期时间或设置为永久性key\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.")]),s._v("后台刷新数据\n\t\t启动定时任务，高峰期来临之前，刷新数据有效期，确保不丢失\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.")]),s._v("二级缓存\n\t\t设置不同的失效时间，保障不会被同时淘汰就行\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.")]),s._v("加锁\n\t\t分布式锁，防止被击穿，但是要注意也是性能瓶颈，慎重！。\n")])])]),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("总结\n\t缓存击穿就是单个高热数据过期的瞬间，数据访问量较大，未命中redis后，发起了大量对同一数据的数据库访问，导致对数据库服务器造成压力。\n\t应对策略应该在业务数据分析与预防方面进行，配合运行监控测试与即时调整策略，毕竟单个key的过期监控难度较高，配合雪崩处理策略即可。\n\n\t与雪崩相比，它的数量变少了，是单个高热数据过期了\n\t瞬间访问量比较大，没有命中以后，同时发起了对数据库的暴力访问\n\t最终导致数据库崩溃\n\n\t应对策略\n\t\t预防为主，通过业务分析增加预防方案\n\t\t同时配合着监控一块来做\n")])])]),a("h2",{attrs:{id:"_4-4-缓存穿透"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-缓存穿透"}},[s._v("#")]),s._v(" 4.4 缓存穿透")]),s._v(" "),a("h3",{attrs:{id:"_110-企业级解决方案-缓存穿透"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_110-企业级解决方案-缓存穿透"}},[s._v("#")]),s._v(" 110-企业级解决方案-缓存穿透")]),s._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("数据库服务器崩溃（"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("）\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.")]),s._v("系统平稳运行过程中\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.")]),s._v("应用服务器流量随时间增量较大\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.")]),s._v("Redis服务器命中率随时间逐步降低\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.")]),s._v("Redis内存平稳，内存无压力\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.")]),s._v("Redis服务器CPU占用激增\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.")]),s._v("数据库服务器压力激增\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.")]),s._v("数据库崩溃\n")])])]),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("问题排查\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.")]),s._v("Redis中大面积出现末命中\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.")]),s._v("出现非正常URL访问\n")])])]),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("问题分析\n\t获取的数据在数据库中也不存在，数据库查询未得到对应数据\n\t"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Redis")]),s._v("获取到"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),s._v("数据未进行持久化，直接返回\n\t下次此类数据到达重复上述过程\n\t出现黑客攻击服务器\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 比较常见的情况是，黑客攻击，它在想办法穿透你的redis服务器，对你的数据库进行攻击")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 这种攻击不是为了得到你的数据，是为了把你的数据库整瘫痪")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 给你大量的无效URL访问，让你的服务器无法命中，然后给数据库带来一个较大的流量，最终把你的数据库整崩掉")]),s._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//非法的访问，错误的URL：大概率就是黑客攻击")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//这种情况就是以防灾为主")]),s._v("\n")])])]),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("解决方案（术）\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.")]),s._v("缓存"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),s._v("\n\t\t对查询结果为"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),s._v("的数据进行缓存（长期使用，定期清理），设定短时限，例如"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v("秒，最高"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("分钟\n\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 不是一个有效的解决方案，只是一个用来缓解穿透的方案")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 通常是临时开启这种东西的情况比较多一些")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 应对比较low的攻击才有一点点效果")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.")]),s._v("白名单策略\n\t\t提前预热各种分类数据id对应的bitmaps，id作为bitmaps的offset，相当于设置了数据白名单。\n\t\t\t当加载正常数据时，放行，加载异常数据时直接拦截（效率偏低）\n\t\t使用布隆过滤器（有关布隆过滤器的命中问题对当前状况可以忽略）\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.")]),s._v("实施监控\n\t\t实时监控redis命中率（业务正常范围时，通常会有一个波动值）与"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),s._v("数据的占比\n\t\t\t非活动时段波动：通常检测"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("倍，超过"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("倍纳入重点排查对象\n\t\t\t活动时段波动：通常检测"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("倍，超过"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("倍纳入重点排查对象\n\t\t根据倍数不同，启动不同的排查流程。然后使用黑名单进行防控（运营）\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.")]),s._v("key加密\n\t\t问题出现后，临时启动防灾业务key，对key进行业务层传输加密服务，设定校验程序，过来的key校验\n\t\t例如每天随机分配"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v("个加密串，挑选"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("到"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("个，混淆到页面数据id中，发现访问key不满足规则，驳回数据访问\n")])])]),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("总结\n\t缓存击穿，是指访问了不存在的数据，跳过了合法数据的redis数据缓存阶段，每次访问数据库，导致对数据库服务器造成压力。\n\t通常此类数据的出现量是一个较低的值，当出现此类情况以毒攻毒，并及时报警。\n\t应对策略应该在临时预案防范方面多做文章。\n\n\t无论是黑名单还是白名单，都是对整体系统的压力，警报解除后尽快移除。\n")])])]),a("h2",{attrs:{id:"_4-5-性能指标监控"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-性能指标监控"}},[s._v("#")]),s._v(" 4.5 性能指标监控")]),s._v(" "),a("h3",{attrs:{id:"_111-企业级解决方案-性能指标监控"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_111-企业级解决方案-性能指标监控"}},[s._v("#")]),s._v(" 111-企业级解决方案-性能指标监控")]),s._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("监控指标\n\t性能指标："),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Performance")]),s._v("\n\t内存指标："),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Memory")]),s._v("\n\t基本活动指标："),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Basic")]),s._v(" activity\n\t持久性指标："),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Persistence")]),s._v("\n\t错误指标："),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Error")]),s._v("\n")])])]),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/redis/20200410210137240.png",alt:""}}),s._v(" "),a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/redis/20200410210341855.png",alt:""}}),s._v(" "),a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/redis/20200410210531431.png",alt:""}}),s._v(" "),a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/redis/2020041021065069.png",alt:""}}),s._v(" "),a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/redis/20200410211015610.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"_112-企业级解决方案-性能指标监控命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_112-企业级解决方案-性能指标监控命令"}},[s._v("#")]),s._v(" 112-企业级解决方案-性能指标监控命令")]),s._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("监控方式\n\t·工具\n\t\t·"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Cloud")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Insight")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Redis")]),s._v("\n\t\t·"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Prometheus")]),s._v("\n\t\t·"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Redis")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("stat\n\t\t·"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Redis")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("faina\n\t\t·"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RedisLive")]),s._v("\n\t\t·zabbix\n\t·命令\n\t\t·benchmark\n\t\t·redis cli\n\t\t\t·monitor\n\t\t\t·showlog\n")])])]),a("p",[s._v("benchmark //进行压测的一个指令(在redis-cli外部使用)，不是redis内部的命令")]),s._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("benchmark "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//进行压测的一个指令")]),s._v("\n\t·命令\n\t\tredis"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("benchmark "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("h"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("c"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("n "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("requests"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\t·范例"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\t\tredis"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("benchmark\n\t\t说明："),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("默认情况下"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("个连接，"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v("次请求对应的性能\n\t·范例"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n\t\tredis"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("benchmark "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("c "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v("\n\t\t说明："),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("个连接，"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v("次请求对应的性能\n")])])]),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/9acme/assets@note/redis/20200410211722817.png",alt:""}})]),s._v(" "),a("p",[s._v("monitor // 这是redis中的一个命令(在redis-cli内部使用)：打印服务器调试信息")]),s._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("monitor\n\t打印服务器调试信息\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 对于初学者来说，可以帮助你理解redis内部整个执行过程,可以看到很多细微的变化")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 针对线上的运行环境，执行这个东西，用它来调试，意义不是特别的大，能看到一些东西")]),s._v("\n")])])]),a("p",[s._v("slowlog // 这是redis中的一个命令(在redis-cli内部使用)：慢日志")]),s._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("slowlog "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("operator"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\t·get：获取慢查询日志\n\t·len：获取慢查询日志条目数\n\t·reset：重置慢查询日志\n·相关配置\n\tslowlog"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("og"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("slower"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("than "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\t#设置慢查询的时间下限，单位：微妙\n\ts1owlog"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("max"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("en "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\t\t\t\t#设置慢查询命令对应的日志显示长度，单位：命令数\n")])])]),a("h2",{attrs:{id:"总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[s._v("#")]),s._v(" 总结")]),s._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("企业级解决方案\n\t◆缓存预热 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 对缓存进行加载之前，先预热一下，防止刚开始就被挂掉")]),s._v("\n\t◆缓存雪崩 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 在一个较短的时间内，大量的key集中失效")]),s._v("\n\t◆缓存击穿 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 一个key失效，但是对它的请求太多，直接通过这一个key击穿过来到达了数据库服务器了")]),s._v("\n\t◆缓存穿透 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 对应的访问数据是不存在的数据，导致redis无法命中，最终全部都压到数据库服务器那儿了")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 每一种现象的解决方案是不太一样的，我们的解决方案是预防为主")]),s._v("\n\t◆性能指标监控 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 五大监控指标")]),s._v("\n\t\t◆工具 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//")]),s._v("\n\t\t◆命令 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//")]),s._v("\n")])])])])}),[],!1,null,null,null);t.default=n.exports}}]);